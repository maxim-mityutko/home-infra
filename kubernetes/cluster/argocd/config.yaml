---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  kustomize.buildOptions: --enable-helm
  # Authentik Auth
  url: https://argocd.brhd.io
  dex.config: |
      connectors:
        - type: oidc
          id: authentik
          name: Authentik
          config:
            issuer: http://auth.brhd.io/application/o/argocd/
            clientID: $argocd-authentik:client_id
            clientSecret: $argocd-authentik:client_secret
            insecureEnableGroups: true
            scopes:
              - openid
              - profile
              - email

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # Authentik Auth
  policy.csv: |
    g, Authentik Admins, role:admin