# Examples:
#
# - DNSEndpoint
#
# apiVersion: externaldns.k8s.io/v1alpha1
# kind: DNSEndpoint
# metadata:
#   name: radarr.brhd.io
#   namespace: media
# spec:
#   endpoints:
#     - dnsName: radarr.brhd.io
#       recordTTL: 86400
#       recordType: CNAME
#       targets:
#         - casa.brhd.io
#
# - Ingress Annotations
#   external-dns.alpha.kubernetes.io/hostname: radarr.brhd.io
#   external-dns.alpha.kubernetes.io/ttl: "1d"
#   external-dns.alpha.kubernetes.io/target: "casa.brhd.io"
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: default
resources:
  - secret.yaml
  - node-handler.yaml
helmCharts:
  - name: external-dns
    namespace: default
    releaseName: external-dns
    version: 9.0.3
    repo: oci://registry-1.docker.io/bitnamicharts
    valuesInline:
      global:
        security:
          # Required for non-Bitnami images
          allowInsecureImages: true
      image:
        # Ref: https://artifacthub.io/packages/helm/external-dns/external-dns
        registry: registry.k8s.io
        repository: external-dns/external-dns
        tag: v0.19.0
      sources:
        - crd
        # - node
        # - ingress
      policy: sync
      logLevel: debug
      rbac:
        create: true
      provider: cloudflare
      cloudflare:
        secretName: cloudflare-external-dns
        proxied: false
      domainFilters:
        - brhd.io
      crd:
        create: true
      interval: 5m
      resourcesPreset: nano
      metrics:
        enabled: true
      revisionHistoryLimit: 1
