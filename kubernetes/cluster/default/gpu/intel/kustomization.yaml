# Ref: https://github.com/intel/helm-charts/blob/intel-device-plugins-gpu-0.32.0/charts/gpu-device-plugin/README.md
# Ref: https://github.com/intel/intel-device-plugins-for-kubernetes/blob/v0.32.0/INSTALL.md
# Ref: https://github.com/intel/intel-device-plugins-for-kubernetes/tree/v0.32.0/deployments/nfd
# Ref: https://github.com/intel/intel-device-plugins-for-kubernetes/blob/v0.32.0/cmd/operator/README.md#installation
# Ref: https://github.com/intel/helm-charts/blob/intel-device-plugins-gpu-0.32.0/charts/gpu-device-plugin/templates/gpu.yaml
# Ref: https://intel.github.io/intel-device-plugins-for-kubernetes/cmd/gpu_plugin/README.html#testing-and-demos
# Ref: https://github.com/intel/intel-device-plugins-for-kubernetes/blob/a8b11406e375c8c41c70eaa73898175e287691b1/demo/intelgpu-job.yaml
# NOTE: https://intel.github.io/intel-device-plugins-for-kubernetes/cmd/gpu_plugin/README.html#running-gpu-plugin-as-non-root
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: gpu
resources:
  - https://raw.githubusercontent.com/kubernetes-sigs/node-feature-discovery/refs/tags/v0.16.4/deployment/helm/node-feature-discovery/crds/nfd-api-crds.yaml
  # - https://raw.githubusercontent.com/intel/intel-device-plugins-for-kubernetes/refs/tags/v0.32.0/deployments/nfd/overlays/node-feature-rules/node-feature-rules.yaml
  # - https://raw.githubusercontent.com/intel/intel-device-plugins-for-kubernetes/refs/tags/v0.32.0/deployments/nfd/overlays/node-feature-rules/platform-labeling-rules.yaml
  - https://raw.githubusercontent.com/intel/helm-charts/refs/tags/intel-device-plugins-operator-0.32.0/charts/device-plugin-operator/crds/deviceplugin.intel.com_gpudeviceplugins.yaml
  - exporter.yaml
  - dashboards/
helmCharts:
  - name: node-feature-discovery
    namespace: gpu
    releaseName: node-feature-discovery
    version: 0.16.4
    repo: https://kubernetes-sigs.github.io/node-feature-discovery/charts
  - name: intel-device-plugins-operator
    namespace: gpu
    releaseName: intel-device-plugins-operator
    version: 0.32.0
    repo: https://intel.github.io/helm-charts
    valuesInline:
      manager:
        devices:
          gpu: true
      nodeSelector:
        kubernetes.io/arch: amd64
      resources:
      limits:
        cpu: 100m
        memory: 120Mi
      requests:
        cpu: 100m
        memory: 100Mi
  - name: intel-device-plugins-gpu
    namespace: gpu
    releaseName: intel-device-plugins-gpu
    version: 0.32.0
    repo: https://intel.github.io/helm-charts/
    valuesInline:
      nodeFeatureRule: true
      enableMonitoring: true
      # The amount of pods that can share the GPU
      sharedDevNum: 10
      # nodeSelector:
      #   # intel.feature.node.kubernetes.io/gpu: 'true'
      #   kubernetes.io/gpu: intel
