apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kube-dashboard
resources:
  - ingress.yaml
  - secret.yaml
helmCharts:
  - name: kubernetes-dashboard
    namespace: kube-dashboard
    releaseName: kubernetes-dashboard
    version: 6.0.8
    repo: https://kubernetes.github.io/dashboard/
    valuesInline: 
      extraArgs:
        - --enable-skip-login
        - --enable-insecure-login
      resources:
        requests:
          cpu: 50m
          memory: 50Mi
        limits:
          memory: 150Mi
      ingress:
        enabled: false
      metricsScraper:
        enabled: true
        resources:
          requests:
            cpu: 50m
            memory: 50Mi
          limits:
            cpu: 50m
            memory: 50Mi
      rbac:
        create: true
      serviceAccount:
        create: true
      nodeSelector:
        node.kubernetes.io/microk8s-controlplane: microk8s-controlplane
      tolerations:
        - key: "node.kubernetes.io/unschedulable"
          operator: Exists
# replacements:
# - source:
#     kind: Secret
#     name: kubernetes-dashboard-token
#     fieldPath: data.token
#   targets:
#   - select:
#       kind: Ingress
#       name: kubernetes-dashboard
#     fieldPaths:
#     - metadata.annotations.[nginx.ingress.kubernetes.io~1configuration-snippet]
#     options:
#       delimiter: "/"
#       index: 1
#       create: true
# patches:
#   - target:
#       kind: Ingress
#       name: kubernetes-dashboard
#     patch: |-
#       - op: add
#         path: /metadata/annotations/nginx.ingress.kubernetes.io~1configuration-snippet
#         valueFrom:
#           secretKeyRef:
#             name: kubernetes-dashboard-token
#             key: token
