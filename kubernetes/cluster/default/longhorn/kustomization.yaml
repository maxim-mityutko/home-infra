# NOTES:
# - To uninstall follow: https://longhorn.io/docs/1.6.1/deploy/uninstall/#uninstalling-longhorn-using-argo-cd
# - If there is an error in defaultSettings, none will be applied. Check "Longhorn Manager" pod for logs
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: longhorn-system
helmCharts:
  - name: longhorn
    namespace: longhorn-system
    releaseName: longhorn
    version: 1.6.1
    repo: https://charts.longhorn.io
    valuesInline:
      defaultSettings:
        backupTarget: nfs://nas.brhd.io:/mnt/spin/backup/longhorn
        replicaAutoBalance: least-effort
        storageOverProvisioningPercentage: 50
        storageMinimalAvailablePercentage: 20
        upgradeChecker: false
        defaultReplicaCount: 3  # For Kubernetes configuration, modify the `numberOfReplicas` field in the StorageClass.
        autoDeletePodWhenVolumeDetachedUnexpectedly: true
        detachManuallyAttachedVolumesWhenCordoned: true
        disableSchedulingOnCordonedNode: true
        orphanAutoDeletion: false
        logLevel: Info
        deletingConfirmationFlag: true
        allowCollectingLonghornUsageMetrics: false
      persistence:
        reclaimPolicy: Delete   # or "Retain"
        migratable: true
        nfsOptions: vers=4.1
      preUpgradeChecker:
        jobEnabled: false
        upgradeVersionCheck: false
      csi:
        kubeletRootDir: /var/snap/microk8s/common/var/lib/kubelet # This should be changed specifically for Microk8s
        attacherReplicaCount: 3
        provisionerReplicaCount: 3
        resizerReplicaCount: 1 
        snapshotterReplicaCount: 1
      longhornUI:
        replicas: 1
      ingress:
        enabled: true
        host: longhorn.brhd.io
        path: /
        annotations:
          kubernetes.io/ingress.class: public
          cert-manager.io/cluster-issuer: lets-encrypt
      openshift:
        enabled: false
