---
apiVersion: operator.victoriametrics.com/v1beta1
kind: VMPodScrape
metadata:
  labels:
    app.kubernetes.io/instance: victoria-metrics
  name: postgres-cnpg-metrics
  namespace: default
spec:
  podMetricsEndpoints:
    - port: metrics
      scheme: http
      scrapeTimeout: 120s
      interval: 10s
      relabelConfigs:
        - target_label: job
          replacement: postgres-cnpg-metrics
        - target_label: cluster
          replacement: postgres-cnpg
      # TODO: fix
      metricRelabelConfigs:
        - sourceLabels: ["__name__"]
          target_label: cluster
          replacement:  postgres-cnpg
  selector:
    matchLabels:
     cnpg.io/cluster: postgres-cnpg