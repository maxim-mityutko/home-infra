apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: extras
resources:
  - dns-endpoint.yaml
helmCharts:
  - name: gitea
    namespace: extras
    releaseName: gitea
    version: 10.6.0
    repo: https://dl.gitea.com/charts/
    valuesInline:
      podSecurityContext:
        fsGroup: 1000
      containerSecurityContext: {}

      service:
        http:
          type: ClusterIP
          port: 3000
        # ssh:
        #   type: ClusterIP
        #   port: 22

      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: public
          cert-manager.io/cluster-issuer: lets-encrypt
        hosts:
          - host: git.brhd.io
            paths:
              - path: /
                pathType: Prefix
        tls: []
        apiVersion: networking.k8s.io/v1

      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
          cpu: 100m
          memory: 128Mi

      serviceAccount:
        create: false

      persistence:
        enabled: false

      signing:
        enabled: false

      actions:
        enabled: false

      gitea:
        admin:
          existingSecret:
          username: gitea-admin
          password: test
          email: "gitea@local.domain"
          passwordMode: initialOnlyNoReset

        metrics:
          enabled: false

        oauth: []
          # - name: 'OAuth 1'
          #   provider:
          #   key:
          #   secret:
          #   existingSecret:
          #   autoDiscoverUrl:
          #   useCustomUrls:
          #   customAuthUrl:
          #   customTokenUrl:
          #   customProfileUrl:
          #   customEmailUrl:

        config:
          database:
            DB_TYPE: sqlite3
          session:
            PROVIDER: memory
          cache:
            ADAPTER: memory
          queue:
            TYPE: level

        livenessProbe:
          enabled: false

        readinessProbe:
          enabled: false

        startupProbe:
          enabled: false

      redis-cluster:
        enabled: false
      redis:
        enabled: false
      postgresql:
        enabled: false
      postgresql-ha:
        enabled: false


      checkDeprecation: true
      test:
        enabled: false
