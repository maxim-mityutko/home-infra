apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: extras
resources:
  - secret.yaml
  - dns-endpoint.yaml
helmCharts:
  - name: gitea
    namespace: extras
    releaseName: gitea
    version: 10.6.0
    repo: https://dl.gitea.com/charts/
    valuesInline:
      image:
        rootless: true
      podSecurityContext:
        fsGroup: 1000
      containerSecurityContext: {}

      service:
        http:
          type: ClusterIP
          port: 3000
        # ssh:
        #   type: ClusterIP
        #   port: 22

      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: public
          cert-manager.io/cluster-issuer: lets-encrypt
        hosts:
          - host: git.brhd.io
            paths:
              - path: /
                pathType: Prefix
        tls: []
        apiVersion: networking.k8s.io/v1

      resources:
        limits:
          cpu: 100m
          memory: 200Mi
        requests:
          cpu: 50m
          memory: 100Mi

      serviceAccount:
        create: false

      persistence:
        enabled: false

      signing:
        enabled: false

      actions:
        enabled: false

      gitea:
        config:
          server:
            DISABLE_SSH: true
            SSH_EXPOSE_ANONYMOUS: false
            START_SSH_SERVER: false
          database:
            DB_TYPE: sqlite3
          session:
            PROVIDER: memory
          cache:
            ADAPTER: memory
          queue:
            TYPE: level


        admin:
          existingSecret: gitea-admin
          passwordMode: initialOnlyNoReset

        metrics:
          enabled: false


        ldap: []
        oauth: []

        livenessProbe:
          enabled: false

        readinessProbe:
          enabled: false

        startupProbe:
          enabled: false

      redis-cluster:
        enabled: false
      redis:
        enabled: false
      postgresql:
        enabled: false
      postgresql-ha:
        enabled: false


      checkDeprecation: true
      test:
        enabled: false
