---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: extras
resources:
  - dns-endpoint.yaml
helmCharts:
  - name: stirling-pdf-chart
    namespace: extras
    releaseName: stirling-pdf
    version: 1.9.0
    repo: https://stirling-tools.github.io/Stirling-PDF-chart
    valuesInline:
      envs:
        - SECURITY_ENABLELOGIN: "false"
        - SYSTEM_ENABLEANALYTICS: "false"
        - SYSTEM_DEFAULTLOCALE: en-US
        - SYSTEM_GOOGLEVISIBILITY: "false"
        - ALLOW_GOOGLE_VISIBILITY: "false"
        - SYSTEM_ENABLEALPHAFUNCTIONALITY: "false"
        - SYSTEM_SHOWUPDATE: "false"
        - METRICS_ENABLED: "false"
        # Ref: https://github.com/Stirling-Tools/Stirling-PDF/blob/v0.36.0/Endpoint-groups.md
        # - ENDPOINTS_TOREMOVE:
        # - ENDPOINTS_GROUPSTOREMOVE: "cli,other,opencv,libreoffice,qpdf,tesseract"
      strategy:
        type: Recreate
      resources:
        requests:
          cpu: 100m
          memory: 250Mi
        limits:
          memory: 500Mi
      serviceMonitor:
        enabled: false
      probes:
        liveness:
          enabled: false
        readiness:
          enabled: false
      serviceAccount:
        create: false
      securityContext:
        enabled: true
        fsGroup: 1000
      persistence:
        enabled: false
      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: public
          cert-manager.io/cluster-issuer: lets-encrypt
        hosts:
          - name: pdf.brhd.io
            path: /
