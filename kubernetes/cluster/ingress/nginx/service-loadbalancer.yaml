---
# ================================================================================================
# DEPRECATED: DNS service exposure via Kubernetes ingress
# 
# This service was previously used to expose non-HTTP(S) services through K8s ingress.
# It is no longer required as DNS access is now managed directly through MetalLB.
#
# Reference: https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/
# ================================================================================================
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-ingress-proxy
  namespace: ingress
  annotations:
    metallb.io/address-pool: service-pool
spec:
  type: LoadBalancer
  allocateLoadBalancerNodePorts: false
  externalIPs:
    - x.x.x.x
  ports:
    - targetPort: 53
      name: dns-tcp
      port: 53
      protocol: TCP
    - targetPort: 53
      name: dns-udp
      port: 53
      protocol: UDP
  selector:
    name: nginx-ingress-microk8s
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-ingress-tcp-microk8s-conf
  namespace: ingress
data:
  "53": default/blocky-dns:53
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-ingress-udp-microk8s-conf
  namespace: ingress
data:
  "53": default/blocky-dns:53
