# Docs: https://docs.openwebui.com
# Chart: https://github.com/open-webui/helm-charts/blob/open-webui-8.12.2/charts/open-webui/README.md
# Repo: https://github.com/open-webui/open-webui
# Description: User-friendly AI Interface (Supports Ollama, OpenAI API, ...)
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: machine-learning
resources:
  - dns-endpoint.yaml
  - open-webui.yaml
  - secret.yaml
helmCharts:
  - name: open-webui
    namespace: machine-learning
    releaseName: open-webui
    version: 8.12.2
    repo: https://helm.openwebui.com/
    valuesInline:
      ollama:
        enabled: false
      pipelines:
        enabled: false
      tika:
        enabled: false
      extraEnvFrom:
        - configMapRef:
            name: open-webui
        - secretRef:
            name: open-webui
      websocket:
        enabled: false
      redis-cluster:
        enabled: false
      image:
        repository: ghcr.io/open-webui/open-webui
      ingress:
        enabled: true
        class: public
        annotations:
          kubernetes.io/ingress.class: public
          cert-manager.io/cluster-issuer: lets-encrypt
        host: oi.brhd.io
      persistence:
        enabled: false
      serviceAccount:
        enable: true
      livenessProbe: {}
      readinessProbe: {}
      resources: {}
      podSecurityContext: {}
      revisionHistoryLimit: 3
      strategy: 
        type: Recreate
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/arch
                    operator: In
                    values: ["amd64"]
                  - key: node.kubernetes.io/microk8s-worker
                    operator: Exists
