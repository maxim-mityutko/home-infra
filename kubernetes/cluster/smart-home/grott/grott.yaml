# Service: Grott
# Label: app.kubernetes.io/name: grott
---
apiVersion: v1
kind: Service
metadata:
  name: grott-external
  namespace: smart-home
  labels:
    app.kubernetes.io/name: grott
spec:
  type: NodePort # 30000-32767
  ports:
    - name: grott
      port: 31279
      targetPort: 5279
      nodePort: 31279
      protocol: TCP
  selector:
    app.kubernetes.io/name: grott
---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: grott
  labels:
    app.kubernetes.io/name: grott
  namespace: smart-home
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/name: grott
  revisionHistoryLimit: 1
  template:
    metadata:
      labels:
        app.kubernetes.io/name: grott
    spec:
      restartPolicy: Always
      containers:
        - image: ledidobe/grott:2.8.2
          name: grott
          resources:
            requests:
              cpu: 50m
              memory: 50Mi
            limits:
              memory: 100Mi
          ports:
            - containerPort: 5279
          envFrom:
            - configMapRef:
                name: grott
          readinessProbe:
            tcpSocket:
              port: 5279
            initialDelaySeconds: 30
            periodSeconds: 10
          livenessProbe:
            tcpSocket:
              port: 5279
            initialDelaySeconds: 30
            periodSeconds: 10
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grott
  namespace: smart-home
  labels:
    app.kubernetes.io/name: grott
data:
  gmode: "proxy"
  gnomqtt: "False"
  gmqttip: "mqtt-tcp-listener.smart-home.svc.cluster.local"
  gmqttport: "1883"
  gmqtttopic: "energy/growatt"
  gmqttauth: "False"
  gpvoutput: "False"
